(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function u(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(e){if(e.ep)return;e.ep=!0;const n=u(e);fetch(e.href,n)}})();async function x(){const p="./camera_para.dat",c="./pattern-marker.patt",u="./model/scene.gltf";var l=[],e,n,o,i=new THREE.WebGLRenderer({alpha:!0});i.setClearColor(new THREE.Color("lightgrey"),0),i.setSize(window.innerWidth,window.innerHeight),i.domElement.style.position="absolute",i.domElement.style.top="0px",i.domElement.style.left="0px",document.body.appendChild(i.domElement);var a=new THREE.Scene,d=new THREE.Camera;a.add(d);var v=new THREE.AmbientLight(16777215);a.add(v),n=new THREE.Group,a.add(n),o=new THREEx.ArToolkitSource({sourceType:"webcam"}),o.init(()=>{o.domElement.addEventListener("canplay",()=>{console.log("canplay","actual source dimensions",o.domElement.videoWidth,o.domElement.videoHeight),y(),h()}),window.arToolkitSource=o});function y(){console.log("initARContext()"),e=new THREEx.ArToolkitContext({cameraParametersUrl:p,detectionMode:"mono",maxDetectionRate:30,canvasWidth:80*3,canvasHeight:60*3}),e.init(function(){d.projectionMatrix.copy(e.getProjectionMatrix()),e.arController.orientation=E(),e.arController.options.orientation=E(),console.log("arToolkitContext",e),window.arToolkitContext=e}),new THREEx.ArMarkerControls(e,n,{type:"pattern",patternUrl:c})}function E(){return o?(console.log("actual source dimensions",o.domElement.videoWidth,o.domElement.videoHeight),o.domElement.videoWidth>o.domElement.videoHeight?(console.log("source orientation","landscape"),"landscape"):(console.log("source orientation","portrait"),"portrait")):null}function R(){var r;console.log("disposeARSource()");const t=document.querySelector("#arjs-video");t&&((r=t==null?void 0:t.srcObject)==null||r.getTracks().map(s=>s.stop()),t.remove()),o=null}function w(){var t,r,s;console.log("disposeARContext()"),(r=(t=e==null?void 0:e.arController)==null?void 0:t.cameraParam)!=null&&r.dispose&&e.arController.cameraParam.dispose(),(s=e==null?void 0:e.arController)!=null&&s.dispose&&e.arController.dispose(),e=null}window.addEventListener("resize",function(){h()});function h(){o.onResizeElement(),o.copyElementSizeTo(i.domElement),e.arController!==null&&o.copyElementSizeTo(e.arController.canvas)}window.close=function(){w(),R()},l.push(function(){!e||!o||!o.ready||(e.update(o.domElement),a.visible=d.visible)}),a.visible=!1;var f=new THREE.Group;a.add(f);var C=new THREEx.ArSmoothedControls(f,{lerpPosition:.4,lerpQuaternion:.3,lerpScale:1});l.push(function(t){C.update(n)});var T=f;const g=(await new THREE.GLTFLoader().loadAsync(u)).scene.children[0].children[0];[...g.children].forEach(t=>{t.rotation.z=0,t.rotation.y=0,t.rotation.x=30,t.scale.set(.25,.25,.25)}),T.add(...g.children),l.push(function(){i.render(a,d)});var m=null;requestAnimationFrame(function t(r){requestAnimationFrame(t),m=m||r-1e3/60;var s=Math.min(200,r-m);m=r,l.forEach(function(H){H(s/1e3,r/1e3)})})}x();
